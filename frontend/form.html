<!DOCTYPE html>
<html>
<head>
  <title>Create Quiz</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    input, textarea { display: block; margin: 10px 0; width: 400px; }
    .option-group { margin-left: 20px; }
  </style>
</head>
<body>
  <h2>Create a Test</h2>

  <label>Test Name: <input id="testName" /></label>
  <label>Question: <textarea id="questionText" rows="3"></textarea></label>

  <div class="option-group">
    <label>Option A: <input id="optA" /></label>
    <label>Option B: <input id="optB" /></label>
    <label>Option C: <input id="optC" /></label>
    <label>Option D: <input id="optD" /></label>
  </div>

  <label>Correct Answer (A/B/C/D): <input id="correct" maxlength="1" /></label>

  <button onclick="addQuestion()">➕ Add Question</button>
  <button onclick="saveTest()">💾 Save Test</button>
  <button onclick="logout()">🚪 Logout</button>

  <p>Total Questions Added: <span id="count">0</span></p>

  <script>
    const BASE_URL = "https://quiz-app-4087.onrender.com"; // Replace with actual backend URL
    let questionList = [];

    function addQuestion() {
      const question = document.getElementById('questionText').value.trim();
      const testName = document.getElementById('testName').value.trim();
      const correct = document.getElementById('correct').value.trim().toUpperCase();

      const options = [
        { label: 'A', text: document.getElementById('optA').value.trim() },
        { label: 'B', text: document.getElementById('optB').value.trim() },
        { label: 'C', text: document.getElementById('optC').value.trim() },
        { label: 'D', text: document.getElementById('optD').value.trim() }
      ];

      if (!testName || !question || !correct || !['A','B','C','D'].includes(correct)) {
        return alert("Fill all fields correctly.");
      }

      questionList.push({ question, options, correct });

      // Clear inputs
      document.getElementById('questionText').value = '';
      document.getElementById('optA').value = '';
      document.getElementById('optB').value = '';
      document.getElementById('optC').value = '';
      document.getElementById('optD').value = '';
      document.getElementById('correct').value = '';

      document.getElementById('count').innerText = questionList.length;
    }

    function saveTest() {
      const testName = document.getElementById('testName').value.trim();

      if (!testName || questionList.length === 0) {
        return alert("Please enter test name and add questions.");
      }

      fetch(`${BASE_URL}/api/quiz/test/${testName}/save`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(questionList)
      })
      .then(res => res.json())
      .then(data => {
        alert("✅ " + data.message);
        questionList = [];
        document.getElementById('count').innerText = 0;
      })
      .catch(err => {
        console.error("Save error", err);
        alert("❌ Test saving failed.");
      });
    }

    function logout() {
      sessionStorage.clear();
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
