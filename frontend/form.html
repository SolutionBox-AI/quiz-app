<!DOCTYPE html>
<html>
<head>
  <title>Create Test Paper</title>
  <style>
    body { font-family: Arial; padding: 30px; }
    label { display: block; margin-top: 10px; }
    button { margin-top: 15px; }
    .question-count { font-weight: bold; color: green; }
  </style>
</head>
<body>
  <script>
    if (sessionStorage.getItem("role") !== "admin") {
      alert("Access denied. Please login as admin.");
      window.location.href = "index.html";
    }
  </script>

  <h2>ğŸ“ Create Test</h2>

  <label>Test Name (will be used as folder):</label>

<input type="text" id="testName" placeholder="Enter Test Name" />
  
  <div id="questionForm">
    <h3>Add Question</h3>
    <label>Question:</label>
    <input type="text" id="question" style="width: 80%;" />

    <label>Option A:</label>
    <input type="text" id="optA" />
    <label>Option B:</label>
    <input type="text" id="optB" />
    <label>Option C:</label>
    <input type="text" id="optC" />
    <label>Option D:</label>
    <input type="text" id="optD" />

    <label>Correct Answer (A/B/C/D):</label>
    <input type="text" id="correct" maxlength="1" />

    <button onclick="addQuestion()">â• Add Question</button>
    <p class="question-count">Questions added: <span id="questionCount">0</span></p>
  </div>

  <button onclick="saveTest()">ğŸ’¾ Save Test</button>
  <button onclick="logout()">ğŸ”’ Logout</button>

  <script>
    const BASE_URL = "https://quiz-app-4087.onrender.com"; // replace with your backend URL
    const questions = [];

    function addQuestion() {
      const q = document.getElementById('question').value.trim();
      const a = document.getElementById('optA').value.trim();
      const b = document.getElementById('optB').value.trim();
      const c = document.getElementById('optC').value.trim();
      const d = document.getElementById('optD').value.trim();
      const correct = document.getElementById('correct').value.trim().toUpperCase();
      const testName = document.getElementById('testName').value.trim();

      if (!q || !a || !b || !c || !d || !correct || !testName) {
        alert("Please fill all fields.");
        return;
      }

      const newQuestion = {
        question: q,
        options: [
          { label: "A", text: a },
          { label: "B", text: b },
          { label: "C", text: c },
          { label: "D", text: d }
        ],
        correct
      };

      questions.push(newQuestion);
      document.getElementById('questionCount').textContent = questions.length;

      // Clear form
      ['question', 'optA', 'optB', 'optC', 'optD', 'correct'].forEach(id => document.getElementById(id).value = '');
    }

// To save test
function saveTest() {
  if (!currentTestId || questions.length === 0) {
    alert("No test name or no questions.");
    return;
  }

  fetch(`${BASE_URL}/api/quiz/test/${currentTestId}/save`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(questions)
  })
  .then(async res => {
    if (!res.ok) {
      const error = await res.json();
      throw new Error(error.error || "Unknown error");
    }
    return res.json();
  })
  .then(data => {
    alert(data.message || "Test saved successfully!");
  })
  .catch(err => {
    console.error("Error saving test:", err);
    alert("Test saving failed: " + err.message);
  });
}

    function logout() {
      sessionStorage.clear();
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
