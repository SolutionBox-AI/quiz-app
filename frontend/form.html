<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Quiz Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    input[type="text"] {
      width: 300px;
      margin: 5px 0;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    .question-section {
      margin-top: 30px;
    }
    #questionCount {
      margin: 10px 0;
      font-weight: bold;
    }
    button {
      margin-right: 10px;
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üìù Create a New Test</h2>

  <label>
    Test Name:
    <input type="text" id="testId" placeholder="e.g., history-class9" onchange="setTestId()" />
  </label>

  <div class="question-section">
    <label>Question:</label>
    <input type="text" id="question" placeholder="Enter your question" />

    <label>Option A:</label>
    <input type="text" id="optA" />

    <label>Option B:</label>
    <input type="text" id="optB" />

    <label>Option C:</label>
    <input type="text" id="optC" />

    <label>Option D:</label>
    <input type="text" id="optD" />

    <label>Select Correct Option:</label>
    <label><input type="radio" name="correct" value="A" /> A</label>
    <label><input type="radio" name="correct" value="B" /> B</label>
    <label><input type="radio" name="correct" value="C" /> C</label>
    <label><input type="radio" name="correct" value="D" /> D</label>
  </div>

  <div id="questionCount">0 question(s) added</div>

  <button onclick="addQuestion()">Add Question</button>
  <button onclick="saveTest()">Save Test</button>
  <button onclick="logout()">Logout</button>

  <script>
    const BASE_URL = "https://your-backend-url.onrender.com"; // üîÅ Replace with your actual backend URL
    let questions = [];
    let currentTestId = "";

    function setTestId() {
      currentTestId = document.getElementById("testId").value.trim();
      updateCount();
    }

    function updateCount() {
      document.getElementById("questionCount").textContent = `${questions.length} question(s) added`;
    }

    function addQuestion() {
      const question = document.getElementById("question").value.trim();
      const optA = document.getElementById("optA").value.trim();
      const optB = document.getElementById("optB").value.trim();
      const optC = document.getElementById("optC").value.trim();
      const optD = document.getElementById("optD").value.trim();
      const correct = document.querySelector('input[name="correct"]:checked');

      if (!question || !optA || !optB || !optC || !optD || !correct) {
        alert("‚ùó Please fill all fields and select the correct answer.");
        return;
      }

      const newQ = {
        question,
        options: [
          { label: "A", text: optA },
          { label: "B", text: optB },
          { label: "C", text: optC },
          { label: "D", text: optD }
        ],
        answer: correct.value
      };

      questions.push(newQ);

      // Clear input fields
      document.getElementById("question").value = "";
      document.getElementById("optA").value = "";
      document.getElementById("optB").value = "";
      document.getElementById("optC").value = "";
      document.getElementById("optD").value = "";
      document.querySelector('input[name="correct"]:checked').checked = false;

      updateCount();
    }

    function saveTest() {
      if (!currentTestId) {
        alert("‚ùó Please enter the test name first.");
        return;
      }

      if (questions.length === 0) {
        alert("‚ùó Please add at least one question.");
        return;
      }

      fetch(`${BASE_URL}/api/quiz/test/${currentTestId}/save`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(questions)
      })
        .then(res => {
          if (!res.ok) {
            return res.json().then(err => { throw new Error(err.error || "Unknown error") });
          }
          return res.json();
        })
        .then(data => {
          alert("‚úÖ " + data.message);
          questions = [];
          updateCount();
        })
        .catch(err => {
          alert("‚ùå Test saving failed: " + err.message);
        });
    }

    function logout() {
      sessionStorage.clear();
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
