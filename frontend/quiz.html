<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; text-align: center; }
    select, input, button { padding: 10px; font-size: 16px; margin: 10px; }
  </style>
</head>
<body>

  <script>
    const role = sessionStorage.getItem("role");
    const name = sessionStorage.getItem("name");
    const userCode = sessionStorage.getItem("userCode");

    if (role !== "student" || !name || !userCode) {
      alert("Access denied. Please login as student.");
      window.location.href = "index.html";
    }
  </script>

  <h2>üéì Welcome, <span id="studentName"></span></h2>

  <label for="testSelect">Choose Test:</label>
  <select id="testSelect">
    <option value="">--Loading Tests--</option>
  </select>

  <button onclick="startQuiz()">Start Quiz</button>
  <button onclick="logout()">Logout</button>

  <script>
    const BASE_URL = "https://quiz-app-4087.onrender.com";

    document.getElementById("studentName").textContent = sessionStorage.getItem("name");

    // Load tests allowed for this student
    window.onload = async () => {
      const res = await fetch(`${BASE_URL}/api/quiz/tests-for-student?name=${name}&code=${userCode}`);
      if (!res.ok) return alert("‚ùå Failed to fetch test list.");
      const tests = await res.json();

      const select = document.getElementById("testSelect");
      select.innerHTML = '<option value="">--Select Test--</option>';
      tests.forEach(test => {
        const opt = document.createElement("option");
        opt.value = test;
        opt.textContent = test;
        select.appendChild(opt);
      });
    };

    function startQuiz() {
      const testId = document.getElementById("testSelect").value;
      if (!testId) return alert("Please select a test.");
      sessionStorage.setItem("selectedTest", testId);
      window.location.href = "take-quiz.html"; // Make sure this exists
    }

    function logout() {
      sessionStorage.clear();
      window.location.href = "index.html";
    }
  </script>

</body>
</html>
